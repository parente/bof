<link rel="import" href="https://cdn.rawgit.com/download/polymer-cdn/1.5.0/lib/paper-card/paper-card.html">
<link rel="import" href="https://cdn.rawgit.com/download/polymer-cdn/1.5.0/lib/paper-fab/paper-fab.html">
<link rel="import" href="https://cdn.rawgit.com/download/polymer-cdn/1.5.0/lib/iron-ajax/iron-ajax.html">
<link rel="import" href="https://cdn.rawgit.com/download/polymer-cdn/1.5.0/lib/iron-icons/iron-icons.html">
<link rel="import" href="https://cdn.rawgit.com/download/polymer-cdn/1.5.0/lib/iron-icons/social-icons.html">
<link rel="import" href="https://cdn.rawgit.com/download/polymer-cdn/1.5.0/lib/iron-icons/maps-icons.html">
<link rel="import" href="https://cdn.rawgit.com/download/polymer-cdn/1.5.0/lib/iron-icons/device-icons.html">

<dom-module id="bof-card">
    <template>
        <style>
            :host {
                max-width: 100%;
                width: 600px;
                margin: 10px auto;
                padding: 10px;
                border-radius: 5px;
                overflow: hidden;
            }

            paper-card {
                width: 100%;
            }

            a {
                font-size: inherit;
                font-weight: inherit;
                text-transform: inherit;
                letter-spacing: inherit;
                line-height: inherit;
                text-decoration: underline;
                color: #777;
            }

            span {
                vertical-align: middle;
            }

            paper-fab {
                display: inline-block;
            }

            .heading {
                margin-bottom: 1em;
            }

            .name {
                font-size: 1.5em;
            }

            .action {
                float: right;
            }

            .description {
                margin-bottom: 1em;
            }

            .details {
                color: #777;
                font-size: 0.8em;
                margin-bottom: 1em;
            }

            .details-group {
                margin-right: 10px;
            }

            .card-actions {
                padding-top: 10px;
                padding-bottom: 10px;
            }

            paper-fab {
                --paper-fab-background: #fff;
                --paper-fab-keyboard-focus-background: #eee;
                color: #777;
            }

            paper-fab[active] {
                color: red;
            }
        </style>

        <iron-ajax id="deleteFlock"
                   url="/api/flocks/[[id]]"
                   method="DELETE"
                   handle-as="json"></iron-ajax>
        <iron-ajax id="joinFlock"
                   url="/api/flocks/[[id]]"
                   method="PUT"
                   handle-as="json"></iron-ajax>

        <paper-card class="bof-card">
            <div class="card-content">
                <div class="heading">
                    <span class="name">[[name]]</span>
                    <span class="action">
                <template is="dom-if" if="[[isOwner(leader)]]">
                    <paper-fab mini
                               on-tap="onEditFlock"
                               icon="create">Modify this flock</paper-fab>
                    <paper-fab mini
                               on-tap="onDeleteFlock"
                               icon="delete">Delete this flock</paper-fab>
                    <paper-fab mini toggles active disabled
                               icon="favorite-border">You lead this flock</paper-fab>
                </template>
                <template is="dom-if" if="[[!isOwner(leader)]]">
                    <paper-fab mini toggles
                               on-tap="onJoinFlock"
                               class="fab-button"
                               icon="favorite-border">Join this flock</paper-fab>
                </template>
            </span>
                </div>
                <div class="description">[[description]]</div>
            </div>
            <div class="card-actions">
                <div class="details">
                    <span class="details-group">
                <iron-icon icon="device:access-time"></iron-icon>
                <span>[[when]]</span>
                    </span>
                    <span class="details-group">
                <iron-icon icon="maps:place"></iron-icon>
                <span>[[where]]</span>
                    </span>
                    <span class="details-group">
                <iron-icon icon="social:person"></iron-icon>
                <span>
                  <a href="https://github.com/[[leader]]" target="_blank" rel="noopener noreferrer">[[leader]]</a> started it</span>
                </span>
                </div>
                <div class="details">
                    <iron-icon icon="social:group"></iron-icon>
                    <template is="dom-if" if="[[birds.length]]">
                        <template is="dom-repeat" items="[[birds]]">
                            <span><a href="https://github.com/[[item]]" target="_blank" rel="noopener noreferrer">[[item]]</a></span>
                        </template>
                        <span>will join</span>
                    </template>
                    <template is="dom-if" if="[[!birds.length]]">
                        <span>No one in the flock yet</span>
                    </template>
                </div>
            </div>
        </paper-card>
    </template>

    <script>
        Polymer({
            is: 'bof-card',

            properties: {
                name: String,
                description: String,
                leader: String,
                when: String,
                where: String,
                birds: Array,
                id: String
            },

            isOwner: function(leader) {
                // TODO: replace with authed user info
                return leader === 'nobody';
            },

            onDeleteFlock: function(evt) {
                // TODO: implement ajax
                console.log(evt);
            },

            onJoinFlock: function(evt) {
                // TODO: implement ajax
                console.log(evt)
            },

            onEditFlock: function(evt) {
                // TODO: implement ajax
                console.log(evt)
            }
        });
    </script>
</dom-module>
